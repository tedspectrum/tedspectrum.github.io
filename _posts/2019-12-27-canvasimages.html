---
layout: post
title: "Canvas Images"
categories: [features]
scripts:
  - url: "https://cdn.jsdelivr.net/npm/vue@2.6.0/dist/vue.min.js"
    type: "absolute"
  - url: "/assets/src/TileMapViewer.js"
    type: "relative"
inlinestyle: >
  <style>
    .hidden {
      display: none;
    }
    canvas {
      border: 1px solid black;
    }
  </style>
inlinescript: >
  <script>
  const app = new Vue({
    el: '#app',
    data: function () {
      let d = {
        keypresses: {
          'a': false,
          'd': false,
          'w': false,
          's': false
        },
        tileMapViewer: {},
        timeAccumulated: 0,
        timePrevious: 0,
        viewHeight: 240,
        viewWidth: 310,
        moveRate: 8,
        tileMap:
          [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 3, 3, 3, 3, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 0, 4, 4, 4, 4, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 0, 4, 4, 4, 4, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
          ]
      };
      return d;
    },
    mounted: function() {
      window.addEventListener("keydown", this.onKeyDown.bind(this));
      window.addEventListener("keyup", this.onKeyUp.bind(this));
    },
    methods: {
      onKeyDown: function (e) {
        if(this.keypresses[e.key] === false) {
          this.keypresses[e.key] = true;
        }
      },
      onKeyUp: function (e) {
        if(this.keypresses[e.key] === true) {
          this.keypresses[e.key] = false;
        }
      },
      run: function () {
        this.tileMapViewer = new TileMapViewer(
          {
            map: this.tileMap,
            spriteSheet: this.$refs.tiles,
            tilesize: 32,
            outputEl: this.$refs.layer1
          }
        );
        this.changed = true;
        this.update(0);
      },
      update: function (timestamp) {
        let myself = this;
        if (this.keypresses.a) { this.move(-1,0); }
        if (this.keypresses.d) { this.move(1,0); }
        if (this.keypresses.w) { this.move(0,-1); }
        if (this.keypresses.s) { this.move(0,1); }
        if (this.changed === true) { 
          this.changed = false;
          this.tileMapViewer.update();
        }
        window.requestAnimationFrame(myself.update);
      },
      move: function (moveX,moveY) {
        this.tileMapViewer.changeXY(moveX * this.moveRate, moveY * this.moveRate);
        this.changed = true;
      }
    }
  });  
  </script>
---
<div id="app" class="app" @keydown="onKeyDown" @keyup="onKeyUp">
  {% raw %}
  <div class="hidden">
    <image ref="tiles" width="640" height="640" src="/assets/canvasimages/tiles.png"></image>
  </div>
  <div><button class="app-button" @click.prevent="run()">Run</button></div>
  <div>
    <button class="app-button" @click.prevent="move(-1,0)">Left (a)</button>
    <button class="app-button" @click.prevent="move(1,0)">Right (d)</button>
    <button class="app-button" @click.prevent="move(0,-1)">Up (w)</button>
    <button class="app-button" @click.prevent="move(0,1)">Down (s)</button>
  </div>
  <canvas ref="layer1"
    :width="viewWidth" :height="viewHeight"
  >
  </canvas>
  {% endraw %}
</div>