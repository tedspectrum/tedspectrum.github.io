---
layout: post
title: "Verlet Integration 1"
scripts:
categories: [physics simulation]
excerpt_separator: <!--more-->
---
{% raw %}
<style>
  .app {
    font-size: 1.5rem;
  }
  canvas {
    display: block;
    top: 0px;
    left: 0px;
    border: 1px solid black;
  }
</style>
<h1>Verlet Integration 1</h1>
<p>Following along with a video from Youtube by "Coding Math"</p>
<p>Added add ball at mouse click</p>
<!--more-->
<div class="app">
  <canvas id="canvas" width="320" height="240"></canvas>
</div>
<script>
  window.onload = function () {
    var canvas = document.getElementById("canvas"),
      context = canvas.getContext("2d"),
      width = canvas.width,
      height = canvas.height,
      points = [],
      bounce = 0.75,
      gravity = 0.5,
      friction = 0.995;
    points.push({
      x: 100,
      y: 100,
      oldx: 95,
      oldy: 95
    },
      {
        x: 50,
        y: 50,
        oldx: 49,
        oldy: 49
      });
    canvas.addEventListener('click', onClick);
    update();

    function onClick(e) {
      points.push({
        x: e.offsetX,
        y: e.offsetY,
        oldx: e.offsetX - 2,
        oldy: e.offsetY - 2
      })
      //console.log(e.offsetX, e.offsetY);
      if (points.length > 8) {
        points.splice(0, 1);
      }
    }

    function update() {
      updatePoints();
      renderPoints();
      requestAnimationFrame(update);
    }

    function updatePoints() {
      var p, vx, vy;
      for (var i = 0; i < points.length; i++) {
        p = points[i],
          vx = (p.x - p.oldx) * friction,
          vy = (p.y - p.oldy) * friction;
        // integration
        p.oldx = p.x;
        p.oldy = p.y;
        p.x = p.x + vx;
        p.y = p.y + vy + gravity;
        // collision detection
        if (p.x > width) {
          p.x = width;
          p.oldx = p.x + vx * bounce;
        }
        else if (p.x < 0) {
          p.x = 0;
          p.oldx = p.x + vx * bounce;
        }
        if (p.y > height) {
          p.y = height;
          p.oldy = p.y + vy * bounce;
        }
        else if (p.y < 0) {
          p.y = 0;
          p.oldy = p.y + vy * bounce;
        }
      }
    }

    function renderPoints() {
      var p, i;
      // clear all
      context.clearRect(0, 0, width, height);
      // draw all
      for (i = 0; i < points.length; i++) {
        p = points[i];
        context.beginPath();
        context.arc(Math.round(p.x), Math.round(p.y), 5, 0, Math.PI * 2);
        context.fill();
      }
    }
  };
</script>
{% endraw %}
